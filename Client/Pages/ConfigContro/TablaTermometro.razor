 @inject HttpClient Http
 @inject SweetAlertService Swal
 @inject IJSRuntime JS
@using CurrieTechnologies.Razor.SweetAlert2
@inject NavigationManager Navigation
<div style="overflow:auto">
    <table class="table table-success table-striped">
        <thead>
            <tr>
                <th scope="col">Nombre</th>
                <th scope="col">Descripcion</th>
                <th scope="col">Editar</th>
                <th scope="col">Eliminar</th>
                <th scope="col">Rangos</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var i in Termometros)
            {
                <tr>
                    <td>@i.Nombre</td>
                    <td>@i.Descripcion</td>
                    <td>
                        <button type="button" class="btn btn-primary" @onclick="(()=>AsignarEdicion(i))" data-bs-toggle="modal" data-bs-target="#EditarTermom">
                            <i class="bi bi-pencil-square"></i>
                        </button>
                    </td>
                    <td>
                        <button type="button" class="btn btn-warning" @onclick="(()=>Eliminar(i))">
                            <i class="bi bi-trash3-fill"></i>
                        </button>
                    </td>
                    <td>
                        <button type="button" class="btn btn-info" @onclick="(()=>AsignarEdicion(i))" data-bs-toggle="modal" data-bs-target="#AgregarCalibracion">
                            <i class="bi bi-thermometer-half"></i>
                        </button>

                    </td>
                </tr>
            }

        </tbody>
    </table>

</div>
<div style="display:flex;justify-content:center">
    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#VuevoTermo">
        Nuevo Termometro
    </button>
</div>

<div class="modal fade" id="VuevoTermo" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <FormularioTermometro />
        </div>
    </div>
</div>
<div class="modal fade" id="EditarTermom" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <EditaTermometro NuevoTermo="termo" />
        </div>
    </div>
</div>
<div class="modal fade" id="AgregarCalibracion" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <FormularioCalibracionTermometro termo="termo" />
        </div>
    </div>
</div>
@code {
    public static List<Termometro> Termometros = new List<Termometro>();
    Termometro termo = new Termometro();
    async Task ActualizarDatos()
    {
        var resultado = await Http.GetFromJsonAsync<List<Termometro>>("api/Termometro");
        if (resultado != null)
            Termometros = resultado;
    }

    protected override async Task OnInitializedAsync()
    {

        await ActualizarDatos();
    }
    async Task Eliminar(Termometro term)
    {
        var resultado = await Swal.FireAsync(new SweetAlertOptions
            {
                Title = "Eliminar",
                Text = "¿ Estas seguro que deseas eliminar ?",
                Icon = SweetAlertIcon.Warning,
                ShowCancelButton = true,
                ConfirmButtonText = "Eliminar",
                CancelButtonText = "Cancelar"
            });

        var confirmado = !string.IsNullOrEmpty(resultado.Value);

        if (confirmado)
        {
            await Http.DeleteAsync($"api/Termometro/{term.Id}");
            await ActualizarDatos();
            var exito = await Swal.FireAsync(new SweetAlertOptions
                {
                    Position = "center",
                    Title = "Eliminado Correctamente",
                    Icon = SweetAlertIcon.Success,
                    ShowCancelButton = false,
                    Timer = 1500
                });
        }
    }

    void AsignarEdicion(Termometro miTerm)
    {
        termo = miTerm;
    }
}
